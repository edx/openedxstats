{% extends "base.html" %}
{% load staticfiles %}
{% block title %} Open edX Sites Map {% endblock %}
{% block bootstrap3_extra_head %}

<link rel="shortcut icon" href="{%  static 'sites/favicon.ico' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" integrity="sha512-WXoSHqw/t26DszhdMhOXOkI7qCiv5QWXhH9R7CgvgZMHz1ImlkVQ3uNsiQKu5wwbbxtPzFXd1hK4tzno2VqhpA==" crossorigin=""></script>
<link rel="stylesheet" href="{% static 'sites/screen.css' %}" />
<link rel="stylesheet" href="{% static 'sites/MarkerCluster.css' %}" />
<link rel="stylesheet" href="{% static 'sites/MarkerCluster.Default.css' %}" />
<script type="text/javascript" language="javascript" src="{% static 'sites/leaflet.markercluster-src.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'sites/allCountries.js' %}"></script>

{% endblock %}

{% block content %}
{% include "navbar.html" %}

<body>

        <style>
                #map {
                    width: 100%;
                    height: 700px;
                    border: 1px solid #ccc;
                }

        </style>
        <div id="map">

        </div>



        <script type="text/javascript">

            var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 5,
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }),
                latlng = new L.LatLng(0, 0);

            var map = new L.Map('map', {center: latlng, zoom: 2, layers: [tiles]});

            var markers = new L.MarkerClusterGroup();
            var markersList = [];

            var northAmericaCluster = new L.MarkerClusterGroup();
            var southAmericaCluster = new L.MarkerClusterGroup();
            var asiaCluster = new L.MarkerClusterGroup({
                test: {
                    testKey: this
                }
            });

            asiaCluster.properties = {};
            asiaCluster.properties.someprop = "test"
            var africaCluster = new L.MarkerClusterGroup();
            var europeCluster = new L.MarkerClusterGroup();
            var oceaniaCluster = new L.MarkerClusterGroup();
/*
            var vietnamCluster = new L.MarkerClusterGroup();
            vietnamCluster.properties = {};
            vietnamCluster.properties.country = 'Vietnam'

            var vietMarker = new L.marker({lat:14.0584, lng: 108.2772}).addTo(vietnamCluster)
            vietMarker.properties = {};
            vietMarker.properties.country = 'Vietnam marker'
            var vietMarker2 = new L.marker({lat:14.0584, lng: 108.2772}).addTo(vietnamCluster)

            //vietnamCluster.addLayer(vietMarker)

            //map.addLayer(vietnamCluster);
            asiaCluster.addLayer(vietnamCluster)
*/
            function populate() {
                for (var i = 0; i < countries.features[0].features.length; i++) {
                    const [lng, lat] = countries.features[0].features[i].geometry.centroid

                    var m = new L.MarkerClusterGroup();
                    const { total_course_count, continent, name } = countries.features[0].features[i].properties
                    console.log(countries.features[0].features[i].properties)
                    m.name = name
                    console.log('Marker', m);
                    m.on('clusterclick', function() {
                        console.log('Clicked on a country', this.name)
                    })
                    for (let j = 0; j < total_course_count; j++) {
                        var marker = new L.marker({lat, lng}).addTo(m);

                    }

                    m.addTo(map);
                }
                return false;
            }
            function populateRandomVector() {
                for (var i = 0, latlngs = [], len = 20; i < len; i++) {
                    latlngs.push(getRandomLatLng(map));
                }
                var path = new L.Polyline(latlngs);
                map.addLayer(path);
            }
            function getRandomLatLng(map) {
                var bounds = map.getBounds(),
                    southWest = bounds.getSouthWest(),
                    northEast = bounds.getNorthEast(),
                    lngSpan = northEast.lng - southWest.lng,
                    latSpan = northEast.lat - southWest.lat;

                return new L.LatLng(
                        southWest.lat + latSpan * Math.random(),
                        southWest.lng + lngSpan * Math.random());
            }


            populate();

            vietnamCluster.on('click', function() {
                console.log('Clicked on Vietnam!')
            })

            asiaCluster.on('clusterclick', function() {
                console.log('Clicked on Asia!', this)
            })

            asiaCluster.eachLayer(function(layer) {
                layer.on('click', function() {

                    console.log('Clicked on something in Asia', layer)
                })
            })

            map.addLayer(markers);
            map.addLayer(asiaCluster);
            map.addLayer(africaCluster);
            map.addLayer(northAmericaCluster);
            map.addLayer(southAmericaCluster);
            map.addLayer(europeCluster);
            map.addLayer(oceaniaCluster);


        </script>
    </body>

{% endblock %}
