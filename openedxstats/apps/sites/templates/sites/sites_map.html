{% extends "base.html" %}
{% load staticfiles %}
{% block title %} Open edX Sites Map {% endblock %}
{% block bootstrap3_extra_head %}

<link rel="shortcut icon" href="{%  static 'sites/favicon.ico' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" integrity="sha512-WXoSHqw/t26DszhdMhOXOkI7qCiv5QWXhH9R7CgvgZMHz1ImlkVQ3uNsiQKu5wwbbxtPzFXd1hK4tzno2VqhpA==" crossorigin=""></script>
<link rel="stylesheet" href="{% static 'sites/screen.css' %}" />
<link rel="stylesheet" href="{% static 'sites/MarkerCluster.css' %}" />
<link rel="stylesheet" href="{% static 'sites/MarkerCluster.Default.css' %}" />
<script type="text/javascript" language="javascript" src="{% static 'sites/leaflet.markercluster-src.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'sites/allCountries.js' %}"></script>

{% endblock %}

{% block content %}
{% include "navbar.html" %}

<body>

        <style>
                #map {
                    width: 100%; 
                    height: 700px; 
                    border: 1px solid #ccc;
                }
                
        </style>
        <div id="map">
            
        </div>
    
        
    
        <script type="text/javascript">
    
            var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }),
                latlng = new L.LatLng(0, 0);
    
            var map = new L.Map('map', {center: latlng, zoom: 2, layers: [tiles]});
    
            var markers = new L.MarkerClusterGroup();
            var markersList = [];
    
            var northAmericaCluster = new L.MarkerClusterGroup();
            var southAmericaCluster = new L.MarkerClusterGroup();
            var asiaCluster = new L.MarkerClusterGroup();
            var africaCluster = new L.MarkerClusterGroup();
            var europeCluster = new L.MarkerClusterGroup();
            var oceaniaCluster = new L.MarkerClusterGroup();
        
            function populate() {
                for (var i = 0; i < countries.features[0].features.length; i++) {
                    const [lng, lat] = countries.features[0].features[i].geometry.centroid

                    const { total_course_count, continent } = countries.features[0].features[i].properties
                    for (let j = 0; j < total_course_count; j++) {
                        var m = new L.marker({lat, lng})

                        // Refactor this later
                        if (continent === 'Asia') {
                            asiaCluster.addLayer(m);
                        }
                        else if (continent === 'Africa') {
                            africaCluster.addLayer(m);
                        }
                        else if (continent === 'South America') {
                            southAmericaCluster.addLayer(m);
                        }
                        else if (continent === 'North America') {
                            northAmericaCluster.addLayer(m);
                        }
                        else if (continent === 'Europe') {
                            europeCluster.addLayer(m);
                        }
                        else if (continent === 'Oceania') {
                            oceaniaCluster.addLayer(m);
                        }
                        else {
                            console.log('Missing continents', continent)
                        }
                    }
                }
                return false;
            }
            function populateRandomVector() {
                for (var i = 0, latlngs = [], len = 20; i < len; i++) {
                    latlngs.push(getRandomLatLng(map));
                }
                var path = new L.Polyline(latlngs);
                map.addLayer(path);
            }
            function getRandomLatLng(map) {
                var bounds = map.getBounds(),
                    southWest = bounds.getSouthWest(),
                    northEast = bounds.getNorthEast(),
                    lngSpan = northEast.lng - southWest.lng,
                    latSpan = northEast.lat - southWest.lat;
    
                return new L.LatLng(
                        southWest.lat + latSpan * Math.random(),
                        southWest.lng + lngSpan * Math.random());
            }

    
            populate();
    
            map.addLayer(markers);
            map.addLayer(asiaCluster);
            map.addLayer(africaCluster);
            map.addLayer(northAmericaCluster);
            map.addLayer(southAmericaCluster);
            map.addLayer(europeCluster);
            map.addLayer(oceaniaCluster);
        
    
  
        </script>
    </body>

{% endblock %}